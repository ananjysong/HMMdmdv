{
    "collab_server" : "",
    "contents" : "#'EM on the data without case 3.\n#'\n#'Simply take the data without case 3 as independent Gaussian mixture and estimate the hyperparameters.\n#'@param dat_df The input data frame.\n#'@param EM_threshold The threshold of parameter diffrences among iterations. Default: 0.0001. Control the number of EM iterations.\n#'@param n1 The sample size of group 1.\n#'@param n2 The sample size of group 2.\n#'@param init_para_est The initial parameter estimates.\n#'@param niter The upper limit for number of EM iterations.\n#'@return The number of iterations and the EM estimate of hyperparameters together with proportion parameters in the setting of no case 3.\n#'@export\n\nrunEM_1 <- function(dat_df, EM_threshold = 0.0001, n1, n2, init_para_est, niter){\n\n  init_para_est_1 <- rep(NA, 7)\n  init_para_est_1[4:7] <- init_para_est[5:8]\n  total <- init_para_est[1] + init_para_est[2] + init_para_est[4]\n  prop1 <- init_para_est[1]/total\n  prop2 <- init_para_est[2]/total\n  prop4 <- init_para_est[4]/total\n  init_para_est_1[1] <- prop1\n  init_para_est_1[2] <- prop2\n  init_para_est_1[3] <- prop4\n\n  theta <- matrix(NA, nrow = niter, ncol = 7)\n  theta[1,]<-c(0.5,0.25,0.25,6,4,2,0.2)\n  theta[2,] <- init_para_est_1\n\n  i <- 2\n  while(max(abs(theta[i,]-theta[i-1,]))>0.0001){\n    p1<-theta[i,1]\n    p2<-theta[i,2]\n    p3<-theta[i,3]\n    nu<-theta[i,4]\n    var<-theta[i,5]\n    k<-theta[i,6]\n    mu<-theta[i,7]\n\n    epc<-apply(dat_df,1,function(x){\n      d1<-f1(x[1:n1],x[(n1+1):(n1+n2)],nu,var,k,mu)\n      d2<-f2(x[1:n1],x[(n1+1):(n1+n2)],nu,var,k,mu)\n      d3<-f3(x[1:n1],x[(n1+1):(n1+n2)],nu,var,k,mu)\n      common_term<-log(p1)+d1+log(1+exp(log(p2)-log(p1)+d2-d1)+exp(log(p3)-log(p1)+d3-d1))\n      fai1<-log(p1)+d1-common_term\n      fai2<-log(p2)+d2-common_term\n      fai3<-log(p3)+d3-common_term\n      fai1<-exp(fai1)\n      fai2<-exp(fai2)\n      fai3<-exp(fai3)\n      return(c(fai1,fai2,fai3))\n    })\n    epct<-t(epc)\n\n    keep <- complete.cases(epct)\n    epct <- epct[keep,]\n    dat_df <- dat_df[keep,]\n    theta[i+1,1]<-sum(epct[,1])/dim(dat_df)[1]\n    theta[i+1,2]<-sum(epct[,2])/dim(dat_df)[1]\n    theta[i+1,3]<-sum(epct[,3])/dim(dat_df)[1]\n\n\n    loglik<-function(para){\n      B<-apply(dat_df,1,function(x){\n        a1<-f1(x[1:n1],x[(n1+1):(n1+n2)],para[1],para[2],para[3],para[4])\n        b1<-f2(x[1:n1],x[(n1+1):(n1+n2)],para[1],para[2],para[3],para[4])\n        c1<-f3(x[1:n1],x[(n1+1):(n1+n2)],para[1],para[2],para[3],para[4])\n        return(c(a1,b1,c1))\n      })\n      return(-sum(diag(epct%*%B)))}\n\n    theta[i+1,4:7]<-optim(c(nu,var,k,mu),loglik)$par\n    i <- i + 1\n  }\n  return(c(i,theta[i,]))\n}\n\n\n\n#'EM on the data without case 3.\n#'\n#'Simply take the data without case 3 as independent Gaussian mixture and estimate the hyperparameters.\n#'@param dat_df The input data frame.\n#'@param EM_threshold The threshold of parameter diffrences among iterations. Default: 0.0001. Control the number of EM iterations.\n#'@param n1 The sample size of group 1.\n#'@param n2 The sample size of group 2.\n#'@param init_para_est The initial parameter estimates.\n#'@param niter The upper limit for number of EM iterations.\n#'@return The EM estimate of hyperparameters together with proportion parameters in the setting of no case 3.\n#'@export\n\nrunEM <- function(dat_df, EM_threshold = 0.0001, n1, n2, init_para_est, niter){\n\n  EM_para_est <- runEM_1(dat_df = dat_df, EM_threshold = EM_threshold, n1 = n1, n2 = n2, init_para_est = init_para_est, niter = niter)\n  i <- EM_para_est[1]\n  theta_est <- EM_para_est[-1]\n\n  PI <- (1-init_para_est[3])*theta_est[1:3]\n  PI<-c(PI[1],PI[2],init_para_est[3],PI[3])\n  nu<-theta_est[4]\n  var<-theta_est[5]\n  k<-theta_est[6]\n  mu<-theta_est[7]\n\n  indep_para_est <- c(PI, nu, var, k, mu)\n  print('independent EM parameter estimate:')\n  print(indep_para_est)\n  return(indep_para_est)\n}\n",
    "created" : 1512608025578.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3912582740",
    "id" : "AA0988C7",
    "lastKnownWriteTime" : 1512627414,
    "last_content_update" : 1512627414117,
    "path" : "~/HMMdmdv/R/runEMindep.R",
    "project_path" : "R/runEMindep.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}